# مرحله ۱: ورودی‌های ساختاریافته
## موضوع اصلی:
{main_topic}

## خلاصه‌ای از داده‌های ورودی (حداکثر ۵۰ کلمه):
{input_summary}

## کلیدواژه‌های فنی مرتبط:
{keywords}

---

# مرحله ۲: نقش و الزامات اولیه
در نقش یک Lead Process Safety Engineer با تخصص در:
- HAZOP و BowTie Analysis صنعتی
- LOPA و تحلیل لایه‌های حفاظتی
- Digital Twin و هوش مصنوعی ایمنی

⚠️ خروجی: یک BowTie Diagram صنعتی و قابل اجرا (نه مفهومی)

---

# مرحله ۳: ساختار BowTie (اجباری)
1. **Hazard**: {hazard}
2. **Threats/Causes**: 
   - {threat1}
   - {threat2}
   - {threat3}
3. **Preventive Barriers**: 
   - {barrier1}
   - {barrier2}
   - {barrier3}
4. **Top Event**: {top_event}
5. **Mitigative Barriers**: 
   - {mitigative1}
   - {mitigative2}
6. **Consequences**: 
   - {consequence1}
   - {consequence2}

---

# مرحله ۴: لایه‌های چندگانه
- Physical/Technical: {physical_elements}
- Control & Instrumentation: {control_elements}
- Human & Organizational: {human_elements}
- Digital/Cyber: {digital_elements}
- Management & Governance: {management_elements}

---

# مرحله ۵: Digital Twin & AI
## Digital Twin Layer:
{digital_twin_elements}

## AI Intelligence:
- Adaptive Preventive Barrier: {adaptive_barrier}
- Optimized Mitigative Barrier: {optimized_barrier}
- Operational Decision: {ai_decision}

---

# مرحله ۶: What-if Scenarios
1. سناریو ۱: {scenario1}
2. سناریو ۲: {scenario2}
3. سناریو ۳: {scenario3}
4. سناریو ۴: {scenario4}

---

# مرحله ۷: خروجی Mermaid (مهم ترین بخش و خیلی اجباری )
فقط کد Mermaid را تولید کن با:
- flowchart LR
- subgraph برای هر بخش
- استایل‌دهی دقیق (Hazard زرد، Threats آبی، etc.)
- اتصالات منطقی BowTie

---

# مرحله ۸: تحلیل فنی (مهم ترین بخش و خیلی اجباری )
پس از کد Mermaid، تحلیل فنی مختصر ارائه کن.