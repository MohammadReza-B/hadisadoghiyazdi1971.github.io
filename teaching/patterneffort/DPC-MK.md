---
layout: persian
title: "UniForCE"
permalink: /teaching/studenteffort/patterneffort/DPC-MK/
dir: rtl
classes: wide rtl-layout
author_profile: true
description: "ูพุงุฏูโุณุงุฒ ู ุขุฒูุงุด ุงูฺฏูุฑุชู DPC-MK"
use_math: true
mathjax: true

header:
  overlay_image: "/assets/images/background.jpg"
  overlay_filter: 0.3
  overlay_color: "#5e616c"
  caption: "Photo credit: [**Unsplash**](https://unsplash.com)"
---


# ๐ ูพุฑูฺู DPC-MK

**ุนููุงู ูพุฑูฺู:** ูพุงุฏูโุณุงุฒ ู ุขุฒูุงุด ุงูฺฏูุฑุชู DPC-MK  
**ูุงู ุฏุงูุดุฌู:** ูุฑุฎูุฏู ุฎูุดููุฏ  
**ุงูู:** F.khoshnoud24@gmail.com  
**ููุทุน:** ุฏุงูุดุฌู ูุฌุงุฒ ููุด ูุตููุนุ ุฏุงูุดฺฏุงู ูุฑุฏูุณ ูุดูุฏ  

---

# ููุฏูู:
ุฏุฑ ุฏูุง ุงูุฑูุฒู ู ุจุง ูพุดุฑูุช ุนูู ู ฺฏุณุชุฑุด ฺฉุณุจ ู ฺฉุงุฑูุงุ ุฏุงุฏู ูุง ุขููุฏุฑ ูพฺุฏู ู ฺฏุณุชุฑุฏู ุดุฏู ุงูุฏ ฺฉู ุจุฑุง ุฏุณุชู ุจูุฏ ุง ุจู ุนุจุงุฑุช ุฎูุดู ุจูุฏ ุจุนุถ ุงุฒู ุฏุงุฏู ูุง ูุงุฒ ุจู ุงูฺฏูุฑุชูโ ุจุฑุง ุฎูุดู ุจูุฏ ุขููุงุณุชุ ฺฉ ุงุฒ ุงูฺฏูุฑุชู ูุง ูุชุนุฏุฏ ฺฉู ุจุฑุง ุฎูุดู ุจูุฏ ุฏุงุฏู ูุง ูุนุฑู ุดุฏูโุงุณุชุ ุงูฺฏูุฑุชู **DPC-MK** ุงุณุช ฺฉู ุฏุฑูุงูุน ุงู ุงูฺฏูุฑุชู ูููููโ ุชูุณุนู ุงูุชู ุงุฒ ุงูฺฏูุฑุชู **DPC**  ุงุณุช.

## ูพุดโุฒููู: ุงูฺฏูุฑุชู DPC
ุจุฑุง ุงูฺฉู ุจุชูุงูู ุงูฺฏูุฑุชู DPC-MK  ุฑุง ุจูุชุฑ ุฏุฑฺฉ ฺฉููุ ุงุจุชุฏุง ูุงุฒู ุงุณุช ฺฉู ุจู DPC ุจูพุฑุฏุงุฒู.  
ุงูฺฏูุฑุชู **DPC (Density Peaks Clustering)** ุง ุจุนุจุงุฑุช ุฎูุดูโุจูุฏ ุจุง ูููโูุง ฺฺฏุงูุ ฺฉ ุฑูุด ุฎูุดูโุจูุฏ ูุจุชู ุจุฑ ฺฺฏุงู ุงุณุช ฺฉู ุฏุฑ ุขู ุฏู ูุนุงุฑ ุงุตู ุจุฑุง ูุฑ ููุทู ูุญุณุงุจ ูโุดูุฏ:

1. **ฺฺฏุงู ูุญู (ฯ - rho):** ูุดุงู ูโุฏูุฏ ฺูุฏุฑ ููุงุท ุฏุฑ ุงุทุฑุงู ููุทูโ ููุฑุฏูุธุฑ ูุดุฑุฏู ูุณุชูุฏ.  
2. **ูุงุตูู ุงุฒ ููุงุท ุจุง ฺฺฏุงู ุจุงูุงุชุฑ (ฮด - delta):** ูุดุงู ูโุฏูุฏ ููุทูโ ููุฑุฏูุธุฑ ฺูุฏุฑ ุงุฒ ููุงุท ฺฉู ฺฺฏุงู ุจุดโุชุฑ ุงุฒ ุฎูุฏุด ุฏุงุฑูุฏุ ุฏูุฑูุณุช.

ุจุนุฏ ุงุฒ ูุญุงุณุจูโ ฯ ู ฮดุ ูููุฏุงุฑ ฮด ุฏุฑ ุจุฑุงุจุฑ ฯ ุฑุณู ูโุดูุฏ (**decision graph**).  
ุฏุฑ ุงู ูููุฏุงุฑุ ููุงุท ฺฉู ูู ฺฺฏุงู ุจุงูุง ุฏุงุฑู (ฯ ุฒุงุฏ) ู ูู ุงุฒ ุจููโ ููุงุท ฺฺฏุงูโุชุฑ ุฏูุฑููุฏ (ฮด ุฒุงุฏ)ุ ุจู ุนููุงู **ูุฑฺฉุฒ ุฎูุดูโูุง** ุฏุฑ ูุธุฑ ฺฏุฑูุชู ูโุดููุฏ.

ุจู ุฒุจุงู ุฎู ุณุงุฏูุ ูุฑุถ ฺฉูุฏ ฺฉุณุฑ ููุทู ุฑู ุตูุญู ุฏุงุฑู.  
ูุฑ ููุทู ูุดุงูโุฏููุฏูโ ู ุฏุงุฏู ุงโุณุช (ูุซูุงู ูููุนุช ู ูุฑุฏ ุฏุฑ ุดูุฑุ ุฑูฺฏ ฺฉ ูพฺฉุณู ู ุง ูฺฺฏ ฺฉ ููููู).  
ุญุงู ูุฑุงุฑ ุงุณุช ุงู ููุงุท ุจู ฺูุฏ ยซุฎูุดูยป ุชูุณู ุดููุฏ.  
ุงุฏู ุงุตู DPC ุจู ุงูฺฏููู ุงุณุช ฺฉู ูุฑ ุฎูุดู ฺฉ "ูููโ ฺฺฏุงู" ุฏุงุฑุฏ ฺฉู ุจุนููุงู ูุฑฺฉุฒ ุฎูุดู ุงูุชุฎุงุจ ูโุดูุฏุ ุงูฺฏูุฑุชู ูโุฎูุงูุฏ ุงู ูููโูุง (ููุงุท ุจุง ฺฺฏุงู ุจุงูุง ู ุฏูุฑ ุงุฒ ูููโูุง ุฏฺฏุฑ) ุฑุง ูพุฏุง ฺฉูุฏ.

---

# ุฏู ุฑูุด ูุนุฑูู ุจุฑุง ุงูุฏุงุฒูโฺฏุฑ ฺฺฏุงู ูุฌูุฏ ุฏุงุฑุฏ

ฑ. **ุฑูุด ุณุงุฏู (Cut-off distance):**  
ุจุฑุง ูุฑ ููุทู ูโุดูุงุฑุฏ ฺฉู ฺูุฏ ููุทู ุฏุฑ ูุงุตููโ ฺฉูุชุฑ ุงุฒ ฺฉ ุนุฏุฏ ูุดุฎุต (ูุซูุงู ฑ.ฐ) ุงุฒ ุขู ูุฌูุฏ ุฏุงุฑุฏ.  
ูุฑ ฺู ุจุดุชุฑุ ุนู ฺฺฏุงูโุชุฑ.

<div dir="ltr">

$$
\rho_i = \sum_j \chi(d_{ij} - d_c)
$$

</div>

ุฏุฑูุงูุน \( d_c \) ููุงู ุงูุฏุงุฒูโุง ุงุณุช ฺฉู ููุงุท ุจุง ูุงุตููโ ฺฉูุชุฑ ุงุฒ ุงู ุงูุฏุงุฒู ุจุง ููุทูโ ููุฑุฏูุธุฑุ ุจุฑุง ฺฺฏุงู ุขู ููุทู ุดูุฑุฏู ูโุดููุฏ.  
ุชุงุจุน \(x) ุจู ุงู ุตูุฑุช ุนูู ูโฺฉูุฏ:  
ุณูพุณ ูุฌููุน ุงู ฐ ู ฑ โูุง ุจู ุนููุงู ฺฺฏุงู ุจุฑฺฏุฑุฏุงูุฏู ูโุดููุฏ.  

ูฺฉุชู ุงูฺฉู ูุงุตููโ ูุฑ ููุทู ุจุง ุฎูุฏุด ูู ุฏุฑ ุงู ุชุงุจุน ฑ ุจุฑฺฏุฑุฏุงูุฏู ูโุดูุฏ ู ุจุฑุง ุฌููฺฏุฑ ุงุฒ ุดูุฑุฏู ุดุฏู ุฎูุฏ ููุทู ุฏุฑ ฺฺฏุงู ุขูุ ุฏุฑ ฺฉุฏ ุงูฺฏูุฑุชู ููุงุชุงู ฺฉ ูุงุญุฏ ุงุฒ ฺฺฏุงู ุจุฏุณุช ุขูุฏู ฺฉู ูโุดูุฏ.  

ฒ. **ุฑูุด ุจูโุฏุณุช ุขูุฑุฏู ฺฺฏุงู ุจุง ุชุงุจุน ฺฏูุณ:**  

<div dir="ltr">

$$
\rho_i = \sum_j e^{-(d_{ij}/d_c)^2}
$$

</div>

ุจุนุฏ ุงุฒ ุจุฏุณุช ุขูุฑุฏู ฺฺฏุงู ููุงุทุ ุงูฺฏูุฑุชู ูุงุตููโ ููุทู ุชุง ููุงุท ฺฺฏุงูโุชุฑ ุงุฒ ุฎูุฏุด ุฑุง ูุญุงุณุจู ูโฺฉูุฏ:

<div dir="ltr">

$$
\delta_i = \min_{j: \rho_j > \rho_i} (d_{ij})
$$

</div>

ุฏุฑ ููุงุชุ ุงูฺฏูุฑุชู ููุงุท ฺฉู ูู ฺฺฏุงู ุฒุงุฏ ุฏุงุฑูุฏ (ููู ูุณุชูุฏ)ุ ู ูู ุงุฒ ููุงุท ฺฺฏุงูโุชุฑ ุฏฺฏุฑ ุฏูุฑ ูุณุชูุฏ (ุนู ฺฉ ูููโ ูุณุชููโุงูุฏ)ุ ุฑุง ุจู ุนููุงู ูุฑฺฉุฒ ุฎูุดู ุงูุชุฎุงุจ ูโฺฉูุฏ.  
ุฏุฑ ูููุฏุงุฑ ุชุตูู (Decision Graph)ุ ุงู ููุงุท ูุนูููุงู ุฏุฑ ุจุงูุง ุณูุช ุฑุงุณุช ุฏุฏู ูโุดููุฏ.

ุฏุฑ ุงุฏุงูู ุชุตูุฑ ุงุฒ ููุงุท ูุฑุถ ุจู ุนููุงู ุฏุงุฏูโูุง ู ฺฺฏููฺฏ ูพุฑุงฺฉูุฏู ุดุฏู ุงู ููุงุท ุฏุฑ ฺฏุฑุงู ุชุตูู ุญุงุตู ุงุฒ ุงูฺฏูุฑุชู DPC ูุดุงูุฏู ูโฺฉูู:

<div align='center'>
<img src="/assets/patterneffort/DPC-MK/Decision_Graph_DPC.png" alt="Decision Graph DPC" width="600"/>
</div>


> ุฎูุดูโูุง ุญุงุตู ุงุฒ ุงู ุชุตูุฑ ุจุง ุฏู ุฑูฺฏ ูุฑูุฒ ู ุขุจ ููุงุด ุฏุงุฏู ุดุฏูโุงูุฏุ ู ุฑูฺฏ ุณุงู ุจู ูุนู ููุฒ ุงุณุช.


<h2 dir="rtl">ูุฒุงุง:</h2>
<ol dir="rtl" style="text-align: right; list-style-position: inside; line-height: 1.8;">
  <li><b>ุนุฏู ูุงุฒ ุจู ุชุนู ุชุนุฏุงุฏ ุฎูุดูโูุง ุงุฒ ูุจู</b><br>
  ุจุฑุฎูุงู ุงูฺฏูุฑุชูโูุง ูุซู K-Meansุ ูุงุฒ ุจู ุฏุงูุณุชู ููุฏุงุฑ k (ุชุนุฏุงุฏ ุฎูุดูโูุง) ุงุฒ ูุจู ูุณุช.</li>
  
  <li><b>ูุงุจูุช ุดูุงุณุง ุฎูุดูโูุง ุจุง ุดฺฉู ูุงููุธู</b><br>
  ฺูู ุงูฺฏูุฑุชู ุจุฑ ูพุงูโ ฺฺฏุงู ุงุณุชุ ูโุชูุงูุฏ ุฎูุดูโูุง ุจุง ุดฺฉูโูุง ุบุฑฺฉุฑู ุง ูพฺุฏู ุฑุง ูุฒ ุชุดุฎุต ุฏูุฏ.</li>
  
  <li><b>ููุงูู ฺฺฏุงู (ฯ) ู ูุงุตูู (ฮด) ุณุงุฏูโุงูุฏ ู ุฎุฑูุฌ ฺฏุฑุงูฺฉ (ูููุฏุงุฑ ฮดโฯ) ูุงุจู ุชูุณุฑ ุงุณุช</b><br>
  ูโุชูุงู ุจุง ูฺฏุงู ฺฉุฑุฏู ุจู ูููุฏุงุฑ ุจุฑุงุญุช ุชุนุฏุงุฏ ุฎูุดูโูุง ุฑุง ุชุดุฎุต ุฏุงุฏ.</li>
  
  <li><b>ุชูุงูุง ุดูุงุณุง ููุฒ ู ุฏุงุฏูโูุง ูพุฑุช</b><br>
  ููุงุท ุจุง ฺฺฏุงู ูพุงู ู ูุงุตูู ุฒุงุฏ ุงุฒ ุจูู ูุนูููุงู ุจู ุนููุงู ููุฒ ุดูุงุณุง ูโุดููุฏ.</li>
  
  <li><b>ุงุณุชููุงู ุงุฒ ููุงุณ ุฏุงุฏูโูุง</b><br>
  ุงฺฏุฑ ุฏุงุฏูโูุง ูุฑูุงูโุณุงุฒ ุดููุฏุ DPC ูุนูููุงู ุจู ููุงุณโุจูุฏ ุฎุงุต ุญุณุงุณ ูุณุช.</li>
</ol>

---

<h2 dir="rtl">ูุนุงุจ:</h2>
<ol dir="rtl" style="text-align: right; list-style-position: inside; line-height: 1.8;">
  <li><b>ุงูุชุฎุงุจ ุฏุณุช ูุฑุงฺฉุฒ ุฎูุดูโูุง</b><br>
  ูุฑุงฺฉุฒ ุฎูุดู ุงุฒ ุฑู ูููุฏุงุฑ ฮดโฯ ุชูุณุท ฺฉุงุฑุจุฑ ุงูุชุฎุงุจ ูโุดููุฏุ ูู ุจูโุตูุฑุช ุฎูุฏฺฉุงุฑ.  
  ุงู ุจุงุนุซ ูโุดูุฏ ุงูฺฏูุฑุชู ูููโุฎูุฏฺฉุงุฑุ ูุงุจุณุชู ุจู ูุถุงูุช ุงูุณุงู ู ุบุฑุชฺฉุฑุงุฑูพุฐุฑ ุจุงุดุฏ.</li>
  
  <li><b>ูพฺุฏฺฏ ุฒูุงู ุจุงูุง</b><br>
  ูุญุงุณุจูโ ูุงุตูู ุจู ุชูุงู ุฌูุชโููุงุทโูุง ุฒูุงูโุจุฑ ุงุณุช.</li>
  
  <li><b>ุญุณุงุณุช ุจู ููุฒ ุฒุงุฏ</b><br>
  ูุฑฺูุฏ ูโุชูุงูุฏ ููุฒ ุฑุง ุชุดุฎุต ุฏูุฏุ ุงูุง ุงฺฏุฑ ููุฒ ุฎู ุฒุงุฏ ุจุงุดุฏุ ููฺฉู ุงุณุช ูููโูุง ฺฉุงุฐุจ ุงุฌุงุฏ ุดููุฏ ู ุฎูุดูโูุง ุงุดุชุจุงู ุชุดุฎุต ุฏุงุฏู ุดููุฏ.</li>
</ol>

---

## ุงูฺฏูุฑุชู DPC-MK
ุฏุฑ ูุณุฎูโ **DPC-KM** (ฺฉู ุชุฑฺฉุจ ุงุฒ DPC ู K-Means ูุณุช)ุ ุถุนูโูุง DPC ูุซู ุงูุชุฎุงุจ ุฏุณุช ูุฑุงฺฉุฒ ุง ุฏูุช ูพุงู ุฏุฑ ูุฑุฒุจูุฏ ุฎูุดูโูุง ุจุฑุทุฑู ูโุดูุฏ.  
ุฏุฑ ุงู ุงูฺฏูุฑุชู ุนูุงูู ุจุฑ ฺฺฏุงู ูุญูุ ูุฒุฏฺฉโุชุฑู ููุณุงู ูู ูุญุงุณุจู ูโุดูุฏ.  

ุนู ุฏุฑ **DPC-KM**ุ ุจุนุฏ ุงุฒ ูุญุงุณุจูโ ฺฺฏุงู ูุฑ ููุทู (ฯ)ุ ุงูฺฏูุฑุชู ููุท ุจู ููุฏุงุฑ ฺฺฏุงู ุจุณูุฏู ููโฺฉูุฏุ ุจูฺฉู ุจุฑุฑุณ ูโฺฉูุฏ ฺฉู ูุฑ ููุทู ูุฒุฏฺฉโุชุฑู ููุณุงูโ ุจุง ฺฺฏุงู ุจุงูุงุชุฑุงุฒ ุฎูุฏุด ุฑุง ุดูุงุฎุชู ู ุจู ุขู ูุชุตู ุดูุฏ.

### ุจุทูุฑ ุฎูุงุตู:
ุฏุฑ DPC-KMุ "ูุฒุฏฺฉโุชุฑู ููุณุงู ุจุง ฺฺฏุงู ุจุงูุงุชุฑ" ุจุฑุง ูุฑ ููุทู ูุดุฎุต ูโุดูุฏุ ุนู ุจุฑุง ูุฑ ููุทู ูุดุฎุต ูโุดูุฏ ฺฉู ุจุงุฏ ุจู ฺฉุฏุงู ูุฑฺฉุฒ (ูููโ ฺฺฏุงู) ูุชุตู ุดูุฏุ  
ฺฉู ุฏุฑุงู ุตูุฑุช ุฎูุดูโุจูุฏ ุจูโุตูุฑุช ุฎูุฏฺฉุงุฑุชุฑ ู ุฏููโุชุฑ ุงูุฌุงู ูโุดูุฏ ู ุจุฎุด K-Means ูุฑุฒูุง ุฎูุดูโูุง ุฑุง ุงุตูุงุญ ูโฺฉูุฏ.

### ูุชุงุฌ
 ุชุดุฎุต ุจูุชุฑ ุฎูุดูโูุง ุบุฑุฎุท  
 ฺฉุงูุด ุฎุทุง ุฏุฑ ุฏุงุฏูโูุง ูุฑุฒ  

---


## ฑ. ูุฏุฑ ูุงู / ุชูุถุญุงุช
```python
"""
dpc_mk.py
A compact implementation of Density Peaks Clustering with a simple "MK" (multi-K / mutual-KNN)
extension to strengthen neighborhood relations. This is intended as an easy-to-run
research/demo implementation (not highly optimized for very large datasets).
"""
```

---

## ฒ. ูุงุฑุฏ ฺฉุฑุฏู ฺฉุชุงุจุฎุงููโูุง (imports)

| ุฎุท ฺฉุฏ | ุชูุถุญ |
|:------|:------|
| `import matplotlib.pyplot as plt` | ฺฉุชุงุจุฎุงูู matplotlib ุฑุง ุจุฑุง ุฑุณู ูููุฏุงุฑูุง ูุงุฑุฏ ูโฺฉูุฏ ู ูุงู ูุณุชุนุงุฑ `plt` ุจู ุขู ูโุฏูุฏ. |
| `from sklearn.datasets import make_moons, make_blobs` | ุชูุงุจุน ุงุฒ scikit-learn ุจุฑุง ุชููุฏ ุฏุงุฏูโูุง ูุตููุน (ุฏุงุฏูโูุง ููุงู ู ุชูุฏูโุง) ุฌูุช ุขุฒูุงุด ุงุณุชูุงุฏู ูโุดููุฏ. |
| `from dpc_mk import dpc_mk` | ุชุงุจุน ุงุตู ุฎูุดูโุจูุฏ DPC-MK ุฑุง ุงุฒ ูุงฺูู ูุญู dpc_mk ูุงุฑุฏ ูโฺฉูุฏ. |

---

```python
import numpy as np
from sklearn.metrics import pairwise_distances
from sklearn.neighbors import NearestNeighbors
```

---

## ณ. ุชุงุจุน `compute_rho`
ุชูุถุญ: ูุญุงุณุจู ฺฺฏุงู ุณุงุฏู โ ุชุนุฏุงุฏ ููุงุท ฺฉู ูุงุตููโุดุงู ฺฉูุชุฑ ุงุฒ `dc` ุงุณุช (ุจู ุงุฒุง ูุฑ ููุทู).

```python
def compute_rho(dist_matrix, dc):
    # rho: ุชุนุฏุงุฏ ููุงุท ุจุง ูุงุตูู ฺฉูุชุฑ ุงุฒ dc (ูุณุฎู ุณุงุฏู)
    n = dist_matrix.shape[0]
    rho = np.sum(dist_matrix < dc, axis=1) - 1  # ฺฉู ฺฉุฑุฏู ุฎูุฏู ููุทู
    return rho
```

---

## ด. ุชุงุจุน `compute_delta`
ุชูุถุญ: ุจุฑุง ูุฑ ููุทู ูุงุตูู ุชุง ูุฒุฏฺฉโุชุฑู ููุทู ุจุง ฺฺฏุงู ุจุงูุงุชุฑ ู ุงูุฏุณู ุขู ุฑุง ูุญุงุณุจู ูโฺฉูุฏ.

```python
def compute_delta(dist_matrix, rho):
    n = dist_matrix.shape[0]
    delta = np.full(n, np.inf)
    nneigh = np.full(n, -1, dtype=int)
    order = np.argsort(-rho)  # ูุฒูู
    for i_idx, i in enumerate(order):
        if i_idx == 0:
            delta[i] = np.max(dist_matrix[i])
            nneigh[i] = -1
        else:
            higher = order[:i_idx]
            dists = dist_matrix[i, higher]
            j = higher[np.argmin(dists)]
            delta[i] = dist_matrix[i, j]
            nneigh[i] = j
    return delta, nneigh
```

---

## ต. ุชุงุจุน `build_mk_score`
ุชูุถุญ: ุณุงุฎุช ูุงุชุฑุณ ูุฒู W ุจุฑุงุณุงุณ ฺูุฏ ฺฏุฑุงู k-NN. ุงฺฏุฑ `mutual=True` ููุท ูุจูโูุง ูุชูุงุจู ูฺฏู ุฏุงุดุชู ูโุดููุฏ.

```python
def build_mk_score(X, k_list=(5,10,15), mutual=True):
    """
    Build a weighted adjacency score matrix W based on multiple k-NN graphs.
    W[i,j] = number of times j appears in i's kNN across k_list.
    If mutual=True, keep only mutual edges via min(W, W^T).
    Returns: W (n x n float)
    """
    X = np.asarray(X)
    n = X.shape[0]
    W = np.zeros((n, n), dtype=float)
    for k in k_list:
        k_use = min(k, n-1)
        nbrs = NearestNeighbors(n_neighbors=k_use+1).fit(X)
        _, idx = nbrs.kneighbors(X)
        for i in range(n):
            neighs = idx[i, 1:]  # skip itself
            for j in neighs:
                W[i, j] += 1.0
    if mutual:
        W = np.minimum(W, W.T)
    return W
```

---

## ถ. ุชุงุจุน `assign_labels_with_mk`
ุชูุถุญ: ูุงฺฏุฐุงุฑ ุจุฑฺุณุจโูุง ุจุง ุฏูุจุงู ฺฉุฑุฏู `nneigh` (ุฑูุด ุงุณุชุงูุฏุงุฑุฏ DPC). ุงฺฏุฑ `W` ุฏุงุฏู ุดุฏู ุจุงุดุฏุ ุงุฒ ุขู ุจุฑุง ุชุฑุฌุญ ุฏุงุฏู ูุงูุฏ ุจุง ูุฒู ููโุชุฑ ุงุณุชูุงุฏู ูโุดูุฏ.

```python
def assign_labels_with_mk(dist_matrix, rho, nneigh, centers_idx, W=None):
    """
    Assign labels by following nneigh (standard DPC assignment),
    but if W is provided, use W to break ties in ambiguous cases:
    prefer assigning to neighbor with stronger W weight.
    """
    n = dist_matrix.shape[0]
    labels = -np.ones(n, dtype=int)
    for idx, c in enumerate(centers_idx):
        labels[c] = idx

    order = np.argsort(-rho)
    for i in order:
        if labels[i] != -1:
            continue
        j = nneigh[i]
        if j == -1:
            # fallback: assign to nearest center
            d2cent = dist_matrix[i, centers_idx]
            labels[i] = np.argmin(d2cent)
        else:
            # normally inherit label of nneigh
            # but if W exists and multiple possible parents, pick by W
            labels[i] = labels[j]
            if W is not None:
                # check among higher-rho neighbors for strongest W
                higher_idx = np.where(rho > rho[i])[0]
                if higher_idx.size > 0:
                    cand = higher_idx
                    weights = W[cand, i]
                    best = cand[np.argmax(weights)]
                    if labels[best] != -1:
                        labels[i] = labels[best]
    return labels
```

---

## ท. ุชุงุจุน ุงุตู `dpc_mk`
ุชูุถุญ: ุงุฌุฑุง ฺฉุงูู ุงูฺฏูุฑุชู ุจุง ูุญุงุณุจู `dc`ุ `rho`ุ `delta`ุ `gamma`ุ ุงูุชุฎุงุจ ูุฑุงฺฉุฒ ู ุณุงุฎุช W ู ุฏุฑ ููุงุช ูุงฺฏุฐุงุฑ ุจุฑฺุณุจโูุง.

```python
def dpc_mk(X, percent_dc=2.0, k_list=(5,10,15), top_centers=None, mutual=True):
    """
    Main function:
    - X: (n_samples, n_features)
    - percent_dc: percentile for dc (default 2.0)
    - k_list: list/tuple of k values for MK scoring
    - top_centers: if int, choose this many centers (otherwise sqrt heuristic)
    - mutual: whether MK uses mutual edges
    Returns dict with labels, centers_idx, rho, delta, gamma, dc
    """
    X = np.asarray(X)
    n = X.shape[0]
    dist = pairwise_distances(X)
    # compute dc using percentile of pairwise distances
    if n <= 1:
        raise ValueError("Need at least 2 samples")
    dists = dist[np.triu_indices(n, 1)]
    dc = np.percentile(dists, percent_dc)

    rho = compute_rho(dist, dc)
    delta, nneigh = compute_delta(dist, rho)
    gamma = rho * delta

    if top_centers is None:
        top_centers = max(1, int(np.sqrt(n)))
    centers_idx = np.argsort(-gamma)[:top_centers]

    # build MK score
    W = build_mk_score(X, k_list=k_list, mutual=mutual)

    labels = assign_labels_with_mk(dist, rho, nneigh, centers_idx, W=W)

    return {
        "labels": labels,
        "centers_idx": centers_idx,
        "rho": rho,
        "delta": delta,
        "gamma": gamma,
        "dc": dc,
        "W": W
    }
```

---

## ธ. ุจุฎุด ุงุฌุฑุง ุณุฑุน (smoke test)

```python
if __name__ == "__main__":
    X1, _ = make_moons(n_samples=300, noise=0.08, random_state=0)
    res1 = dpc_mk(X1, percent_dc=2.0, k_list=(5,10,15), mutual=True)
    plot_clusters(X1, res1["labels"], res1["centers_idx"], title="moons - DPC-MK")

    X2, _ = make_blobs(n_samples=400, centers=4, cluster_std=0.6, random_state=1)
    res2 = dpc_mk(X2, percent_dc=2.0, k_list=(5,10,20), mutual=True)
    plot_clusters(X2, res2["labels"], res2["centers_idx"], title="blobs - DPC-MK")
```

| ุฎุท ฺฉุฏ | ุชูุถุญ |
|:------|:------|
| `if __name__ == "__main__":` | ุงุทููุงู ุญุงุตู ูโฺฉูุฏ ฺฉู ุงู ฺฉุฏ ุชููุง ุฏุฑ ุตูุฑุช ุงุฌุฑุง ูุณุชูู ูุงู ุงุฌุฑุง ุดูุฏ. |
| `X1, _ = make_moons(...)` | ุฏุงุฏูโูุง ููุงู ุดฺฉู (Moons) ุฑุง ุจุฑุง ุขุฒูุงุด ุชููุฏ ูโฺฉูุฏ. |
| `res1 = dpc_mk(X1, ...)` | ุงุฌุฑุง ุงูฺฏูุฑุชู DPC-MK ุจุฑ ุฑู ุฏุงุฏูโูุง ููุงู. |
| `plot_clusters(X1, ...)` | ููุงุด ูุชุงุฌ ุฎูุดูโุจูุฏ ุฏุงุฏูโูุง ููุงู. |
| `X2, _ = make_blobs(...)` | ุชููุฏ ุฏุงุฏูโูุง ุชูุฏูโุง (Blobs) ุจุง ด ุฎูุดูโ ูุฌุฒุง. |
| `res2 = dpc_mk(X2, ...)` | ุงุฌุฑุง ุงูฺฏูุฑุชู DPC-MK ุจุฑ ุฑู ุฏุงุฏูโูุง ุชูุฏูโุง. |
| `plot_clusters(X2, ...)` | ููุงุด ูุชุงุฌ ุฎูุดูโุจูุฏ ุฏุงุฏูโูุง ุชูุฏูโุง. |
---

## ๐งฉ ูุงฺูู ุงุตู (`dpc_mk.py`)

ุงู ูุงู ุดุงูู ุชูุงุจุน ุฒุฑ ุงุณุช:

- `compute_rho` โ ูุญุงุณุจู ฺฺฏุงู ูุญู  
- `compute_delta` โ ูุญุงุณุจู ูุงุตูู ฮด  
- `build_mk_score` โ ุณุงุฎุช ูุงุชุฑุณ ูุฒู Multi-K  
- `assign_labels_with_mk` โ ุชุฎุตุต ุจุฑฺุณุจโูุง  
- `dpc_mk` โ ุงุฌุฑุง ฺฉุงูู ุงูฺฏูุฑุชู  

---

## ๐ท ุฎุฑูุฌโูุง ููููู

| ุชุตูุฑ | ุชูุถุญ |
|:--|:--|
| ![Figure-1](https://i.ibb.co/4gWm2xYV/Figure-1.png)
|![Figure-2](https://i.ibb.co/r2zFnx30/Figure-2.png)

---

## ๐งฎ ฺฉุงุฑุจุฑุฏูุง

 ุฒุณุชโุฏุงุฏูโูุง *(Bioinformatics)*  
 ุจูุง ูุงุดู *(Computer Vision)*  
 ุชุญูู ุจุงุฒุงุฑ ู ุฏุงุฏูโูุง ูพฺุฏู *(Marketing Data Analysis)*  

---

## ๐ ูุชุฌูโฺฏุฑ

ุงูฺฏูุฑุชู **DPC-MK** ูุงุฏุฑ ุงุณุช ุฎูุดูโูุง ุบุฑูุฑฺฉุฒ ุฑุง ุจุง ุฏูุช ุจุงูุง ุดูุงุณุง ฺฉูุฏ.  
ุงูุฒูุฏู ูุคูููโ Multi-K ุจุงุนุซ ฺฉุงูุด ุฎุทุง ู ุจูุจูุฏ ุฏูุช ุฏุฑ ุฏุงุฏูโูุง ูพฺุฏู ูโุดูุฏ.

**ูพุดููุงุฏ:** ุงุณุชูุงุฏู ุงุฒ DPC-MK ุฏุฑ ุฏุงุฏูโูุง ุจุฒุฑฺฏโุชุฑ ู ููุงุณู ุจุง ุณุงุฑ ุฑูุดโูุง ุฎูุดูโุจูุฏ.

